{"version":3,"file":"observe-slot-text.js","sources":["../../shared/observe-slot-text.ts"],"sourcesContent":["/**\n * Copyright 2026 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\nimport { PropertyValues, ReactiveElement } from 'lit';\nimport { property, queryAssignedNodes } from 'lit/decorators.js';\nimport { MutationController } from '@lit-labs/observers/mutation-controller.js';\n\nconst assignedNodesList = Symbol('assignedNodes');\n\ntype Constructor<T = Record<string, unknown>> = {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    new (...args: any[]): T;\n    prototype: T;\n};\n\nexport interface SlotTextObservingInterface {\n    slotHasContent: boolean;\n    manageTextObservedSlot(): void;\n}\n\nexport function ObserveSlotText<T extends Constructor<ReactiveElement>>(\n    constructor: T,\n    slotName?: string,\n    excludedSelectors: string[] = []\n): T & Constructor<SlotTextObservingInterface> {\n    const notExcluded = (el: HTMLElement) => (selector: string) => {\n        return el.matches(selector);\n    };\n\n    class SlotTextObservingElement\n        extends constructor\n        implements SlotTextObservingInterface\n    {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        constructor(...args: any[]) {\n            super(...args);\n\n            new MutationController(this, {\n                config: {\n                    characterData: true,\n                    subtree: true,\n                },\n                callback: (mutationsList: Array<MutationRecord>) => {\n                    for (const mutation of mutationsList) {\n                        if (mutation.type === 'characterData') {\n                            this.manageTextObservedSlot();\n                            return;\n                        }\n                    }\n                },\n            });\n        }\n\n        /**\n         * @internal\n         */\n        @property({ type: Boolean, attribute: false })\n        public slotHasContent = false;\n\n        @queryAssignedNodes({\n            slot: slotName,\n            flatten: true,\n        })\n        private [assignedNodesList]!: NodeListOf<HTMLElement>;\n\n        /**\n         * @internal\n         */\n        public manageTextObservedSlot(): void {\n            if (!this[assignedNodesList]) {\n                return;\n            }\n            const assignedNodes = [...this[assignedNodesList]].filter(\n                (currentNode) => {\n                    const node = currentNode as HTMLElement;\n                    if (node.tagName) {\n                        return !excludedSelectors.some(notExcluded(node));\n                    }\n                    return node.textContent ? node.textContent.trim() : false;\n                }\n            );\n            this.slotHasContent = assignedNodes.length > 0;\n        }\n\n        protected override update(changedProperties: PropertyValues): void {\n            if (!this.hasUpdated) {\n                const { childNodes } = this;\n                const textNodes = [...childNodes].filter((currentNode) => {\n                    const node = currentNode as HTMLElement;\n                    if (node.tagName) {\n                        const excluded = excludedSelectors.some(\n                            notExcluded(node)\n                        );\n                        return !excluded\n                            ? // This pass happens at element upgrade and before slot rendering.\n                              // Confirm it would exisit in a targeted slot if there was one supplied.\n                              slotName\n                                ? node.getAttribute('slot') === slotName\n                                : !node.hasAttribute('slot')\n                            : false;\n                    }\n                    return node.textContent ? node.textContent.trim() : false;\n                });\n                this.slotHasContent = textNodes.length > 0;\n            }\n            super.update(changedProperties);\n        }\n\n        protected override firstUpdated(\n            changedProperties: PropertyValues\n        ): void {\n            super.firstUpdated(changedProperties);\n            this.updateComplete.then(() => {\n                this.manageTextObservedSlot();\n            });\n        }\n    }\n    return SlotTextObservingElement;\n}\n"],"names":["assignedNodesList","ObserveSlotText","constructor","slotName","excludedSelectors","_a","_b","notExcluded","el","selector","SlotTextObservingElement","args","MutationController","mutationsList","mutation","assignedNodes","currentNode","node","changedProperties","childNodes","textNodes","__decorateClass","property","queryAssignedNodes"],"mappings":";;;;;;;AAeA,MAAMA,IAAoB,OAAO,eAAe;AAazC,SAASC,EACZC,GACAC,GACAC,IAA8B,CAAA,GACa;AAhC/C,MAAAC,GAAAC;AAiCI,QAAMC,IAAc,CAACC,MAAoB,CAACC,MAC/BD,EAAG,QAAQC,CAAQ;AAAA,EAG9B,MAAMC,WACMJ,IAAAJ,GAiCCG,IAAAL,GAjCDM,GAEZ;AAAA;AAAA,IAEI,eAAeK,GAAa;AACxB,YAAM,GAAGA,CAAI,GAsBjB,KAAO,iBAAiB,IApBpB,IAAIC,EAAmB,MAAM;AAAA,QACzB,QAAQ;AAAA,UACJ,eAAe;AAAA,UACf,SAAS;AAAA,QAAA;AAAA,QAEb,UAAU,CAACC,MAAyC;AAChD,qBAAWC,KAAYD;AACnB,gBAAIC,EAAS,SAAS,iBAAiB;AACnC,mBAAK,uBAAA;AACL;AAAA,YACJ;AAAA,QAER;AAAA,MAAA,CACH;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAiBO,yBAA+B;AAClC,UAAI,CAAC,KAAKd,CAAiB;AACvB;AAEJ,YAAMe,IAAgB,CAAC,GAAG,KAAKf,CAAiB,CAAC,EAAE;AAAA,QAC/C,CAACgB,MAAgB;AACb,gBAAMC,IAAOD;AACb,iBAAIC,EAAK,UACE,CAACb,EAAkB,KAAKG,EAAYU,CAAI,CAAC,IAE7CA,EAAK,cAAcA,EAAK,YAAY,SAAS;AAAA,QACxD;AAAA,MAAA;AAEJ,WAAK,iBAAiBF,EAAc,SAAS;AAAA,IACjD;AAAA,IAEmB,OAAOG,GAAyC;AAC/D,UAAI,CAAC,KAAK,YAAY;AAClB,cAAM,EAAE,YAAAC,MAAe,MACjBC,IAAY,CAAC,GAAGD,CAAU,EAAE,OAAO,CAACH,MAAgB;AACtD,gBAAMC,IAAOD;AACb,iBAAIC,EAAK,UACYb,EAAkB;AAAA,YAC/BG,EAAYU,CAAI;AAAA,UAAA,IAQd;AAAA;AAAA;AAAA,YAHAd,IACIc,EAAK,aAAa,MAAM,MAAMd,IAC9B,CAACc,EAAK,aAAa,MAAM;AAAA,cAGhCA,EAAK,cAAcA,EAAK,YAAY,SAAS;AAAA,QACxD,CAAC;AACD,aAAK,iBAAiBG,EAAU,SAAS;AAAA,MAC7C;AACA,YAAM,OAAOF,CAAiB;AAAA,IAClC;AAAA,IAEmB,aACfA,GACI;AACJ,YAAM,aAAaA,CAAiB,GACpC,KAAK,eAAe,KAAK,MAAM;AAC3B,aAAK,uBAAA;AAAA,MACT,CAAC;AAAA,IACL;AAAA,EAAA;AA1DO,SAAAG,EAAA;AAAA,IADNC,EAAS,EAAE,MAAM,SAAS,WAAW,IAAO;AAAA,EAAA,GA3B3CZ,EA4BK,WAAA,gBAAA,GAMEW,EAAA;AAAA,IAJRE,EAAmB;AAAA,MAChB,MAAMpB;AAAA,MACN,SAAS;AAAA,IAAA,CACZ;AAAA,EAAA,GAjCCO,EAkCO,WAAAL,CAAA,GAsDNK;AACX;"}