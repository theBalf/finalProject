{"version":3,"file":"Base.js","sources":["../../../shared/base/Base.ts"],"sourcesContent":["/**\n * Copyright 2026 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { LitElement, ReactiveElement } from 'lit';\n\nimport { version } from './version.js';\ntype ThemeRoot = HTMLElement & {\n    startManagingContentDirection: (el: HTMLElement) => void;\n    stopManagingContentDirection: (el: HTMLElement) => void;\n};\n\ntype Constructor<T = Record<string, unknown>> = {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    new (...args: any[]): T;\n    prototype: T;\n};\n\nexport interface SpectrumInterface {\n    shadowRoot: ShadowRoot;\n    isLTR: boolean;\n    hasVisibleFocusInTree(): boolean;\n    dir: 'ltr' | 'rtl';\n}\n\nconst observedForElements: Set<HTMLElement> = new Set();\n\nconst updateRTL = (): void => {\n    const dir =\n        document.documentElement.dir === 'rtl'\n            ? document.documentElement.dir\n            : 'ltr';\n    observedForElements.forEach((el) => {\n        el.setAttribute('dir', dir);\n    });\n};\n\nconst rtlObserver = new MutationObserver(updateRTL);\n\nrtlObserver.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['dir'],\n});\n\ntype ContentDirectionManager = HTMLElement & {\n    startManagingContentDirection?(): void;\n};\n\nconst canManageContentDirection = (el: ContentDirectionManager): boolean =>\n    typeof el.startManagingContentDirection !== 'undefined' ||\n    el.tagName === 'SP-THEME';\n\nexport function SpectrumMixin<T extends Constructor<ReactiveElement>>(\n    constructor: T\n): T & Constructor<SpectrumInterface> {\n    class SpectrumMixinElement extends constructor {\n        /**\n         * @internal\n         */\n        public override shadowRoot!: ShadowRoot;\n        private _dirParent?: HTMLElement;\n\n        /**\n         * @internal\n         */\n        public override dir!: 'ltr' | 'rtl';\n\n        /**\n         * @internal\n         */\n        public get isLTR(): boolean {\n            return this.dir === 'ltr';\n        }\n        /**\n         * @internal\n         */\n        public hasVisibleFocusInTree(): boolean {\n            const getAncestors = (root: Document = document): HTMLElement[] => {\n                // eslint-disable-next-line @spectrum-web-components/document-active-element\n                let currentNode = root.activeElement as HTMLElement;\n                while (\n                    currentNode?.shadowRoot &&\n                    currentNode.shadowRoot.activeElement\n                ) {\n                    currentNode = currentNode.shadowRoot\n                        .activeElement as HTMLElement;\n                }\n                const ancestors: HTMLElement[] = currentNode\n                    ? [currentNode]\n                    : [];\n                while (currentNode) {\n                    const ancestor =\n                        currentNode.assignedSlot ||\n                        currentNode.parentElement ||\n                        (currentNode.getRootNode() as ShadowRoot)?.host;\n                    if (ancestor) {\n                        ancestors.push(ancestor as HTMLElement);\n                    }\n                    currentNode = ancestor as HTMLElement;\n                }\n                return ancestors;\n            };\n            const activeElement = getAncestors(\n                this.getRootNode() as Document\n            )[0];\n            if (!activeElement) {\n                return false;\n            }\n            // Browsers without support for the `:focus-visible`\n            // selector will throw on the following test (Safari, older things).\n            // Some won't throw, but will be focusing item rather than the menu and\n            // will rely on the polyfill to know whether focus is \"visible\" or not.\n            try {\n                return (\n                    activeElement.matches(':focus-visible') ||\n                    activeElement.matches('.focus-visible')\n                );\n                /* c8 ignore next 3 */\n            } catch (error) {\n                return activeElement.matches('.focus-visible');\n            }\n        }\n\n        public override connectedCallback(): void {\n            if (!this.hasAttribute('dir')) {\n                let dirParent = ((this as HTMLElement).assignedSlot ||\n                    this.parentNode) as HTMLElement;\n                while (\n                    dirParent !== document.documentElement &&\n                    !canManageContentDirection(\n                        dirParent as ContentDirectionManager\n                    )\n                ) {\n                    dirParent = ((dirParent as HTMLElement).assignedSlot || // step into the shadow DOM of the parent of a slotted node\n                        dirParent.parentNode || // DOM Element detected\n                        (dirParent as unknown as ShadowRoot)\n                            .host) as HTMLElement;\n                }\n                this.dir =\n                    dirParent.dir === 'rtl' ? dirParent.dir : this.dir || 'ltr';\n                if (dirParent === document.documentElement) {\n                    observedForElements.add(this);\n                } else {\n                    const { localName } = dirParent;\n                    if (\n                        localName.search('-') > -1 &&\n                        !customElements.get(localName)\n                    ) {\n                        /* c8 ignore next 5 */\n                        customElements.whenDefined(localName).then(() => {\n                            (\n                                dirParent as ThemeRoot\n                            ).startManagingContentDirection(this);\n                        });\n                    } else {\n                        (dirParent as ThemeRoot).startManagingContentDirection(\n                            this\n                        );\n                    }\n                }\n                this._dirParent = dirParent as HTMLElement;\n            }\n            super.connectedCallback();\n        }\n\n        public override disconnectedCallback(): void {\n            super.disconnectedCallback();\n            if (this._dirParent) {\n                if (this._dirParent === document.documentElement) {\n                    observedForElements.delete(this);\n                } else {\n                    (this._dirParent as ThemeRoot).stopManagingContentDirection(\n                        this\n                    );\n                }\n                this.removeAttribute('dir');\n            }\n        }\n    }\n    return SpectrumMixinElement;\n}\n\nexport class SpectrumElement extends SpectrumMixin(LitElement) {\n    static VERSION = version;\n}\n\nif (process.env.NODE_ENV === 'development') {\n    const ignoreWarningTypes = {\n        default: false,\n        accessibility: false,\n        api: false,\n    };\n    const ignoreWarningLevels = {\n        default: false,\n        low: false,\n        medium: false,\n        high: false,\n        deprecation: false,\n    };\n    window.__swc = {\n        ...window.__swc,\n        DEBUG: true,\n        ignoreWarningLocalNames: {\n            ...(window.__swc?.ignoreWarningLocalNames || {}),\n        },\n        ignoreWarningTypes: {\n            ...ignoreWarningTypes,\n            ...(window.__swc?.ignoreWarningTypes || {}),\n        },\n        ignoreWarningLevels: {\n            ...ignoreWarningLevels,\n            ...(window.__swc?.ignoreWarningLevels || {}),\n        },\n        issuedWarnings: new Set(),\n        warn: (\n            element,\n            message,\n            url,\n            { type = 'api', level = 'default', issues } = {}\n        ): void => {\n            const { localName = 'base' } = element || {};\n            const id = `${localName}:${type}:${level}` as BrandedSWCWarningID;\n            if (!window.__swc.verbose && window.__swc.issuedWarnings.has(id)) {\n                return;\n            }\n            if (window.__swc.ignoreWarningLocalNames[localName]) {\n                return;\n            }\n            if (window.__swc.ignoreWarningTypes[type]) {\n                return;\n            }\n            if (window.__swc.ignoreWarningLevels[level]) {\n                return;\n            }\n            window.__swc.issuedWarnings.add(id);\n            let listedIssues = '';\n            if (issues && issues.length) {\n                issues.unshift('');\n                listedIssues = issues.join('\\n    - ') + '\\n';\n            }\n            const intro = level === 'deprecation' ? 'DEPRECATION NOTICE: ' : '';\n            const inspectElement = element\n                ? '\\nInspect this issue in the follow element:'\n                : '';\n            const displayURL = (element ? '\\n\\n' : '\\n') + url + '\\n';\n            const messages: unknown[] = [];\n            messages.push(\n                intro + message + '\\n' + listedIssues + inspectElement\n            );\n            if (element) {\n                messages.push(element);\n            }\n            messages.push(displayURL, {\n                data: {\n                    localName,\n                    type,\n                    level,\n                },\n            });\n            console.warn(...messages);\n        },\n    };\n\n    window.__swc.warn(\n        undefined,\n        'Spectrum Web Components is in dev mode. Not recommended for production!',\n        'https://opensource.adobe.com/spectrum-web-components/dev-mode/',\n        { type: 'default' }\n    );\n}\n"],"names":["_a","_b","_c","observedForElements","updateRTL","dir","el","rtlObserver","canManageContentDirection","SpectrumMixin","constructor","SpectrumMixinElement","activeElement","root","currentNode","ancestors","ancestor","error","dirParent","localName","SpectrumElement","LitElement","version","ignoreWarningTypes","ignoreWarningLevels","element","message","url","type","level","issues","id","listedIssues","intro","inspectElement","displayURL","messages"],"mappings":"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"}